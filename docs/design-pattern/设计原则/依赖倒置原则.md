# 依赖倒置原则

### 引言

#### 什么是依赖（Dependency）？
```java
public class A {

	private B b = new B();

    ...
}
```

上述这段代码中，类 A 中包含一个成员变量，是一个类 B 的对象。这里可以说 **A 依赖 B**。


### 依赖倒置原则

> Dependency Inversion Principle
>
> "High level modules should not depend upon low level modules. Both should depend upon abstractions. Abstractions should not depend upon details. Details should depend upon abstractions."
>
> 1. 高层次的模块不应该依赖于低层次的模块，两者都应该依赖于抽象接口。
> 2. 抽象接口不应该依赖于具体实现。而具体实现则应该依赖于抽象接口。

这是依赖倒置原则的定义。如何理解上述两句话？

#### 1. "高层次的模块不应该依赖于低层次的模块，两者都应该依赖于抽象接口。"
先来看个小例子。假设我们要设计一辆车，其中轮胎就是车的一个模块。设计如下：
```java
public class Car {
	// 面向实现
	private MichelinTire tire = new MichelinTire();

    ...
}

/**
 * 米其林轮胎
 */
public class MichelinTire {
    ...
}
```

上述设计就是**高层次的模块依赖于低层次的模块**。车依赖于轮胎的具体实现 `MichelinTire`，如果 `MichelinTire` 的构造方式发生变化，`Car` 也得修改；而且无法使用其他轮胎。

所以我们可以这么改。
```java
public class Car {
	// 面向接口
	private Tire tire = new MichelinTire();

    ...
}

/**
 * 轮胎
 */
public interface Tire {
    ...
}

/**
 * 米其林轮胎
 */
public class MichelinTire implements Tire {
    ...
}
```

- 我们对轮胎做了一层抽象，创建了一个接口 Tire。
- 把 Car 中的成员变量 tire 的类型从具体类改成了接口，不再依赖于具体实现。

这个改动就是「**高层次的模块不应该依赖于低层次的模块，两者都应该依赖于抽象接口。**」。

#### 2. 为什么叫依赖倒置？
理解到这里可能会有疑问：依赖倒置不应该是低层模块依赖于高层模块吗？为什么 `Car` 类和 `MichelinTire` 类都依赖 `Tire` 接口，这也叫做依赖倒置？

如果光从定义上来看，**其实依赖倒置指的就是高/低层模块都依赖抽象于抽象接口**，并不是真实的让低层模块依赖于高层模块。

但是从代码结构设计的角度来讲，
- 轮胎是车的一部分，车需要轮胎，所以 `Tire` 接口具有哪些功能其实应该由 `Car` 来定义，也就是**高层按照需要定义抽象接口**。
- 而 `MichelinTire` 是根据 `Tire` 接口来实现功能，也就是低层按照高层定义的接口实现接口。

所以这里其实就可以理解成“高层控制低层”，低层依赖抽象接口，间接依赖高层。这样也许能更好的理解「依赖倒置」。

#### 3. "抽象接口不应该依赖于具体实现。而具体实现则应该依赖于抽象接口。"
这句话其实就是上面对于「依赖倒置」的理解。

高层按照需要定义抽象接口，低层按照高层定义的接口实现接口。

#### 4. 核心：面向接口编程，不要面向实现编程


### 为什么要使用依赖倒置原则？

由于在软件设计中，细节具有多变性，而抽象层则相对稳定，因此以抽象为基础搭建起来的架构要比以细节为基础搭建起来的架构要稳定得多。这里的抽象指的是接口或者抽象类，而细节是指具体的实现类。

使用接口或者抽象类的目的是制定好规范和契约，而不去涉及任何具体的操作，把功能的具体实现交给它们的实现类去完成。

**依赖倒置原则的目的就是降低类之间的耦合性，提高代码的可扩展性和可维护性。**


### 实践
- 每个类尽量提供接口或抽象类，或者两者都具备。
- 变量的声明类型尽量是接口或者是抽象类。
- 任何类都不应该从具体类派生。
- 使用继承时尽量遵循里氏替换原则。


### 参考
- [Spring IoC有什么好处呢？ - Mingqi的回答 - 知乎](https://www.zhihu.com/question/23277575/answer/169698662)