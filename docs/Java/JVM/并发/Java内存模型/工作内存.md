# 主内存与工作内存

> Java 内存模型规定：
>
> - 所有的变量都存储在主内存（Main Memory）中（此处的主内存与物理硬件时的主内存名字一样，两者可以类比；但此处仅是虚拟机内存的一部分）。
>
> - 每条线程还有自己的工作内存（Working Memory，可与处理器高速缓存类比）。
>
> - 线程的工作内存中保存了被该线程使用到的变量的主内存副本拷贝，线程对变量的所有操作（读取、赋值等）都必须在工作内存中进行，而不能直接读写主内存中的变量。
>
> - 不同的线程之间也无法直接访问对方工作内存中的变量，线程间变量值的传递均需要通过主内存来完成。


- 关于工作内存中的副本拷贝

    假设线程中访问一个 10MB 的对象，不会把这 10MB 内存复制一份。这个对象的引用、对象中某个在线程访问到的字段有可能存在拷贝，但不会有虚拟机实现成把整个对象拷贝一次。

- `volatile` 变量

    JVM 规定，就算是 `volatile` 变量，仍然有工作内存的拷贝，但是由于它特殊的操作顺序型规定，所以看起来如同直接在主内存读写访问一般，因此这里的描述对于 `volatile` 变量也并不存在例外。

- 名词含义

    这里所讲的主内存、工作内存与 Java 内存区域中的 Java 堆、栈、方法区等并不是同一个层次的内存划分，这两者基本没有关系。如果要勉强对应，从定义来看。「主内存」主要对应于 Java 堆中的对象实例数据部分，而「工作内存」则对应于虚拟机栈中的部分区域。

    从更低层次上说，主内存就直接对应与物理硬件的内存，而为了获取更好的运行速度，虚拟机可能会让「工作内存」优先存储于寄存器和高速缓存中，因为 Java 程序运行时主要访问读写的是工作内存。