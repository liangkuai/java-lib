# 类加载过程

- 加载

- 连接
    - 验证
    - 准备
    - 解析

- 初始化


### 加载（Loading）



### 连接（Linking）


#### 验证（Verification）


#### 准备（Preparation）


#### 解析（Resolution）



### 初始化（Initialization）

#### 必须进行初始化的六种情况

对于初始化阶段，《Java 虚拟机规范》严格规定了**有且只有** 6 种情况，如果类还没有进行过初始化，必须先对类进行「初始化」：

1. 当遇到 `new`、`getstatic`、`putstatic` 或 `invokestatic` 这 4 条字节码指令时，比如：
    - new 一个对象
    - 读取或设置一个类的静态变量(未被 `final` 修饰)
    - 调用一个类的静态方法

2. 使用 `java.lang.reflect` 包的方法对类进行反射调用的时候。

3. 初始化一个类的时候，如果其父类还未初始化，就先触发该父类的初始化。

4. 当虚拟机启动时，用户需要定义一个要执行的主类 (包含 main 方法的那个类)，虚拟机会先初始化这个类。

5. 当使用 JDK 1.7 的动态语言支持时，如果一个 `java.lang.invoke.MethodHandle` 实例最后的解析结果是 `REF_getStatic`、`REF_putStatic`、`REF_invokeStatic`、`REF_newInvokeSpecial` 四种类型的方法句柄，并且这个方法句柄对应的类没有进行过初始化，就需要先触发其初始化。

6. 当一个接口中定义了 JDK 8 新加入的默认方法（被 `default` 关键字修饰的接口方法）时，如果有这个接口的实现类发生了初始化，那该接口要在其之前被初始化。

