# 线程安全

> 当多个线程同时访问一个对象时，如果
> - 不考虑这些线程在运行时环境下的调度和交替执行，
> - 也不需要进行额外的同步，或者在调用方进行任何其他的协调操作，
> 调用这个对象的行为都可以获得正确的结果，那就称这个对象是线程安全的。
>
> ——《Java 并发编程实战（Java Concurrency In Practice）》

这个定义就很严谨而且有可操作性，它要求线程安全的代码都必须具备一个共同特性：**代码本身封装了所有必要的正确性保障手段**（如互斥同步等），让调用者无须关心多线程下的调用问题，更无须自己实现任何措施来保证多线程环境下的正确调用。

在大多数场景中，我们都会将这个定义弱化一些，如果把 **「调用这个对象的行为」限定为「单次调用」**，这个定义的其他描述也能够成立的话，我们就可以称它是线程安全了。

### 类型

#### 不可变

#### 绝对线程安全

#### 相对线程安全

相对的线程安全就是我们通常意义上所讲的线程安全，它需要保证对这个对象单独的操作是线程安全的，我们在调用的时候不需要做额外的保障措施，但是对于一些特定顺序的连续调用，就可能需要在调用端使用额外的同步手段来保证调用的正确性。

#### 线程兼容

线程兼容是指对象本身并不是线程安全的，但是可以通过在调用端正确地使用同步手段来保证对象在并发环境中可以安全使用，我们平常说一个类不是线程安全的，绝大多数时候指的是这一种情况。

Java API 中大部分的类都是属于线程兼容的，如：与 `Vector` 和 `HashTable` 相对应的集合类 `ArrayList` 和 `HashMap` 等。

#### 线程对立

线程对立指的是无论调用端是否采取了同步措施，都无法在多线程环境中并发使用的代码。

由于 Java 天生就具备多线程特性，线程对立这种排斥多线程的代码是很少出现的，而且通常都是有害的，应当尽量避免。


### 线程安全的实现方式

• 互斥同步（阻塞同步）
• 非阻塞同步
• 无同步方式